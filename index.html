<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych-6/jspsych.js"></script>
    <script src="zeyianimation.js"></script>
    <script src="jspsych-6/plugins/jspsych-rdk.js"></script>
    <script src="jspsych-6/plugins/jspsych-animation.js"></script>
    <script src="jspsych-6/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6/plugins/jspsych-image-keyboard-response.js"></script>
    <link href="jspsych-6/css/jspsych.css" rel="stylesheet" type="text/css"></link>
  </head>
  <body></body>
  <script>




    /* create timeline */
    var timeline = [];

    /* define welcome message trial */
    var welcome = {
      type: "html-keyboard-response",
      stimulus: "Welcome to the experiment. Press any key to begin."
    };
    timeline.push(welcome);

    /* define instructions trial */
    // var instructions = {
    //   type: "html-keyboard-response",
    //   stimulus: "<p>In this experiment, a circle will appear in the center " +
    //       "of the screen.</p><p>If the circle is <strong>blue</strong>, " +
    //       "press the letter F on the keyboard as fast as you can.</p>" +
    //       "<p>If the circle is <strong>orange</strong>, press the letter J " +
    //       "as fast as you can.</p>" +
    //       "<div style='width: 700px;'>"+
    //       "<div style='float: left;'><img src='img/blue.png'></img>" +
    //       "<p class='small'><strong>Press the F key</strong></p></div>" +
    //       // "<div class='float: right;'><img src='img/orange.png'></img>" +
    //       "<p class='small'><strong>Press the J key</strong></p></div>" +
    //       "</div>"+
    //       "<p>Press any key to begin.</p>",
    //   post_trial_gap: 2000
    // };
    // timeline.push(instructions);

    /* test trials */

    var page1 = {
      type: "html-keyboard-response",
      stimulus: "In this experiment, you will judge whether more dots are moving to the right side or the left side. "
    };
    timeline.push(page1);

    var test_stimuli = [
      { stimulus: "img/blue.png", data: { test_part: 'test'} },
      // { stimulus: "img/orange.png", data: { test_part: 'test', correct_response: 'j' } }
    ];

    var page2 = {
      type: "html-keyboard-response",
      stimulus: "Dots are randomly moving in three seconds and then they will disappear. You can make a decision. "
    };
    timeline.push(page2);

    var page3 = {
      type: "html-keyboard-response",
      stimulus: "Now you can press F and J key. Press F Key to LEFT. Press J key to RIGHT  "
    };
    timeline.push(page3);

    var page4 = {
      type: "html-keyboard-response",
      stimulus: " One press means one unit of speed. The more times you press, the faster the dot moves. "
    };
    timeline.push(page4);

    var page5 = {
      type: "html-keyboard-response",
      stimulus: "If you want to change dot move to opposite postion, press once to change the position in the lowest speed. Press twice goes back to the normal speed"
    };
    timeline.push(page5);





    var fixation = {
      type: 'html-keyboard-response',
      stimulus: '<div style="font-size:60px;">+</div>',
      choices: jsPsych.NO_KEYS,
      trial_duration: function(){
        return jsPsych.randomization.sampleWithoutReplacement([250, 500, 750, 1000, 1250, 1500, 1750, 2000], 1)[0];
      },
      data: {test_part: 'fixation'}
    }

    var test = {
      type: 'zeyi',
      dot: jsPsych.timelineVariable('stimulus'),
      choices: ['f', 'j'],
      initialkey:  function(){
        return jsPsych.randomization.sampleWithoutReplacement([-1,1], 1)[0];
      },
      boundaryL: function(){
        return jsPsych.randomization.sampleWithoutReplacement([0.1,0.3], 1)[0];
      },
      boundaryR: function(){
        return jsPsych.randomization.sampleWithoutReplacement([0.7,0.9], 1)[0];
      },

      data: jsPsych.timelineVariable('data'),
      on_finish: function(data){

        // data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
      },
    }

    var RDK_trials = [
			{//Condition 1
				correct_choice: 'a', //The correct answer for Condition 1
				coherent_direction: function(){
          return jsPsych.randomization.sampleWithoutReplacement([0,180], 1)[0];
        }, //The coherent direction for Condition 1 (dots move left)
			},
			// {//Condition 2
			// 	correct_choice: 'l', //The correct answer for Condition 2
			// 	coherent_direction: 0 //The coherent direction for Condition 2 (dots move right)
      //
			// },
		];



		//The test block where all the trials are nested. The properties here will trickle down to all trials in the timeline unless they have their own properties defined
		var test_block = {
			type: "rdk",
			post_trial_gap: 500, //The Inter Trial Interval. You can either have no ITI, or have an ITI but change the display element to be the same color as the stimuli background to prevent flashing between trials
			number_of_dots: 50, //Total number of dots in each aperture
			RDK_type: 3, //The type of RDK used
			trial_duration: 1000, //Duration of each trial in ms
			timeline: RDK_trials, //The timeline of all the trials
			background_color: "white",
			dot_color: "black",
      coherence: function(){
        return jsPsych.randomization.sampleWithoutReplacement([0.2, 0.4, 0.6, 0.8], 1)[0];
      },
      opposite_coherence: 0.1

		}



    var test_procedure = {
      // timeline: [fixation, test],
      timeline: [test_block, test],
      timeline_variables: test_stimuli,
      repetitions: 5,
      randomize_order: true
    }
    timeline.push(test_procedure);

    /* define debrief */

    var page4 = {
      type: "html-keyboard-response",
      stimulus: "."
    };
    timeline.push(page4);



    var debrief_block = {
      type: "html-keyboard-response",
      stimulus: function() {

        var trials = jsPsych.data.get().filter({test_part: 'test'});
        var correct_trials = trials.filter({correct: true});
        var accuracy = Math.round(correct_trials.count() / trials.count() * 100);
        var rt = Math.round(correct_trials.select('rt').mean());

        return "<p>You responded correctly on "+accuracy+"% of the trials.</p>"+
        "<p>Your average response time was "+rt+"ms.</p>"+
        "<p>Press any key to complete the experiment. Thank you!</p>";

      }
    };
    timeline.push(debrief_block);

    /* start the experiment */
    jsPsych.init({
      timeline: timeline,
      on_finish: function() {
        jsPsych.data.displayData();
      }
    });
  </script>
</html>
